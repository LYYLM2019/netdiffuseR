<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ego exposure — exposure • netdiffuseR</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Ego exposure — exposure" />
<meta property="og:description" content="Calculates exposure to adoption over time via multiple different types of weight
matrices.  The basic  model is exposure to adoption by immediate neighbors
(outdegree) at the time period prior to ego’s adoption. This exposure can also be
based on (1) incoming ties, (2) structural equivalence, (3) indirect ties, (4)
attribute weighted (5) network-metric weighted (e.g., central nodes have more
influence), and attribute-weighted (e.g., based on homophily or tie strength)." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-40608305-5"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-40608305-5');
</script>


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">netdiffuseR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.20.999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/analyzing-medical-innovation-data.html">netdiffuseR showcase: Medical Innovations</a>
    </li>
    <li>
      <a href="../articles/introduction-to-netdiffuser.html">Simulating diffusion networks: Using the `rdiffnet` function</a>
    </li>
    <li>
      <a href="../articles/not-lost-in-translation-importing-and-exporting-graphs.html">Not-Lost in translation: Getting diffusion data into netdiffuseR</a>
    </li>
    <li>
      <a href="../articles/time_discount_suscep_infect.html">Time Discounted Infection and Susceptibility</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/USCCANA/netdiffuseR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Ego exposure</h1>
    <small class="dont-index">Source: <a href='https://github.com/USCCANA/netdiffuseR/blob/master/R/stats.R'><code>R/stats.R</code></a></small>
    <div class="hidden name"><code>exposure.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Calculates exposure to adoption over time via multiple different types of weight
matrices.  The basic  model is exposure to adoption by immediate neighbors
(outdegree) at the time period prior to ego’s adoption. This exposure can also be
based on (1) incoming ties, (2) structural equivalence, (3) indirect ties, (4)
attribute weighted (5) network-metric weighted (e.g., central nodes have more
influence), and attribute-weighted (e.g., based on homophily or tie strength).</p>
    </div>

    <pre class="usage"><span class='fu'>exposure</span>(
  <span class='no'>graph</span>,
  <span class='no'>cumadopt</span>,
  <span class='kw'>attrs</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>alt.graph</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>outgoing</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"diffnet.outgoing"</span>, <span class='fl'>TRUE</span>),
  <span class='kw'>valued</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"diffnet.valued"</span>, <span class='fl'>FALSE</span>),
  <span class='kw'>normalized</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>groupvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>self</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/options.html'>getOption</a></span>(<span class='st'>"diffnet.self"</span>),
  <span class='kw'>lags</span> <span class='kw'>=</span> <span class='fl'>0L</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>graph</th>
      <td><p>A dynamic graph (see <code><a href='netdiffuseR-graphs.html'>netdiffuseR-graphs</a></code>).</p></td>
    </tr>
    <tr>
      <th>cumadopt</th>
      <td><p>\(n\times T\) matrix. Cumulative adoption matrix obtained from
<code><a href='toa_mat.html'>toa_mat</a></code></p></td>
    </tr>
    <tr>
      <th>attrs</th>
      <td><p>Either a character scalar (if <code>graph</code> is diffnet),
or a numeric matrix of size \(n\times T\). Weighting for each time, period (see details).</p></td>
    </tr>
    <tr>
      <th>alt.graph</th>
      <td><p>Either a graph that should be used instead of <code>graph</code>,
or <code>"se"</code> (see details).</p></td>
    </tr>
    <tr>
      <th>outgoing</th>
      <td><p>Logical scalar. When <code>TRUE</code>, computed using outgoing ties.</p></td>
    </tr>
    <tr>
      <th>valued</th>
      <td><p>Logical scalar. When <code>TRUE</code> weights will be considered. Otherwise non-zero values will be replaced by ones.</p></td>
    </tr>
    <tr>
      <th>normalized</th>
      <td><p>Logical scalar. When <code>TRUE</code>, the exposure will be between zero
and one (see details).</p></td>
    </tr>
    <tr>
      <th>groupvar</th>
      <td><p>Passed to <code><a href='struct_equiv.html'>struct_equiv</a></code>.</p></td>
    </tr>
    <tr>
      <th>self</th>
      <td><p>Logical scalar. When <code>TRUE</code> autolinks (loops, self edges) are allowed (see details).</p></td>
    </tr>
    <tr>
      <th>lags</th>
      <td><p>Integer scalar. When different from 0, the resulting exposure
matrix will be the lagged exposure as specified (see examples).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Further arguments passed to <code><a href='struct_equiv.html'>struct_equiv</a></code> (only used when
<code>alt.graph="se"</code>).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A matrix of size \(n\times T\) with exposure for each node.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Exposure is calculated as follows:</p>
<p>$$ %
E_t = \left(S_t \times \left[x_t \circ A_t\right]\right) / (S_t \times x_t) %
$$</p>
<p>Where \(S_t\) is the graph in time \(t\), \(x_t\) is an attribute
vector of size \(n\) at time \(t\), \(A_t\) is the t-th column of
the cumulative adopters matrix (a vector of length \(n\) with \(a_{ti}=1\)
if \(i\) has adopted at or prior to \(t\)), \(\circ\) is the kronecker
product (element-wise), and \(\times\) is the matrix product.</p>
<p>By default the graph used for this calculation, \(S\), is the social network. Alternatively,
in the case of <code>diffnet</code> objects, the user can provide an alternative
graph using <code>alt.graph</code>. An example of this would be using \(1/SE\),
the element-wise inverse of the structural equivalence matrix (see example below).
Furthermore, if <code>alt.graph="se"</code>, the inverse of the structural equivalence
is computed via <code><a href='struct_equiv.html'>struct_equiv</a></code> and used instead of the provided
graph. Notice that when using a valued graph the option <code>valued</code> should
be equal to <code>TRUE</code>, this check is run automatically when running the
model using structural equivalence.</p>
<p>If the <code>alt.graph</code> is static, then the function will warn about it
and will recycle the graph to compute exposure at each time point.</p>
<p><b>An important remark</b> is that when calculating <b>structural equivalence</b> the
function <b>assumes that this is to be done to the entire graph</b> regardless of
disconnected communities (as in the case of the medical innovations
data set). Hence, structural equivalence for individuals for two different
communites may not be zero. If the user wants to calculate structural
equivalence separately by community, he should create different diffnet
objects and do so (see example below). Alternatively, for the case of
diffnet objects, by using the option <code>groupvar</code> (see <code><a href='struct_equiv.html'>struct_equiv</a></code>), the user can provide
the function with the name of a grouping variable--which should one in the
set of static vertex attributes--so that the algorithm is done by group
(or community) instead of in an aggregated way.</p>
<p>If the user does not specifies a particular weighting attribute in <code>attrs</code>,
the function sets this as a matrix of ones. Otherwise the function will return
an attribute weighted exposure. When <code>graph</code> is of class <code>diffnet</code>,
<code>attrs</code> can be a character scalar specifying the name of any of the graph's
attributes, both dynamic and static. See the examples section for a demonstration using
degree.</p>
<p>When <code>outgoing=FALSE</code>, \(S\) is replaced by its transposed, so in the
case of a social network exposure will be computed based on the incoming ties.</p>
<p>If <code>normalize=FALSE</code> then denominator, \(S_t \times x_t\),
is not included. This can be useful when, for example, exposure needs to be
computed as a count instead of a proportion. A good example of this can be
found at the examples section of the function <code><a href='rdiffnet.html'>rdiffnet</a></code>.</p>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Burt, R. S. (1987). "Social Contagion and Innovation: Cohesion versus Structural
Equivalence". American Journal of Sociology, 92(6), 1287.
<a href='http://doi.org/10.1086/228667'>http://doi.org/10.1086/228667</a></p>
<p>Valente, T. W. (1995). "Network models of the diffusion of innovations"
 (2nd ed.). Cresskill N.J.: Hampton Press.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other statistics: 
<code><a href='bass.html'>bass</a></code>,
<code><a href='classify_adopters.html'>classify_adopters</a>()</code>,
<code><a href='cumulative_adopt_count.html'>cumulative_adopt_count</a>()</code>,
<code><a href='dgr.html'>dgr</a>()</code>,
<code><a href='ego_variance.html'>ego_variance</a>()</code>,
<code><a href='hazard_rate.html'>hazard_rate</a>()</code>,
<code><a href='infection.html'>infection</a>()</code>,
<code><a href='moran.html'>moran</a>()</code>,
<code><a href='struct_equiv.html'>struct_equiv</a>()</code>,
<code><a href='threshold.html'>threshold</a>()</code>,
<code><a href='vertex_covariate_dist.html'>vertex_covariate_dist</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Calculating lagged exposure -----------------------------------------------</span>

<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>8</span>)
<span class='no'>graph</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rdiffnet.html'>rdiffnet</a></span>(<span class='fl'>20</span>, <span class='fl'>4</span>)

<span class='no'>expo0</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>)
<span class='no'>expo1</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>, <span class='kw'>lags</span> <span class='kw'>=</span> <span class='fl'>1</span>)

<span class='co'># These should be equivalent</span>
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>expo0</span>[, -<span class='fl'>4</span>] <span class='kw'>==</span> <span class='no'>expo1</span>[, -<span class='fl'>1</span>])) <span class='co'># No stop!</span>


<span class='co'># Calculating the exposure based on Structural Equivalence ------------------</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>113132</span>)
<span class='no'>graph</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='rdiffnet.html'>rdiffnet</a></span>(<span class='fl'>100</span>, <span class='fl'>10</span>)

<span class='no'>SE</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='fu'><a href='struct_equiv.html'>struct_equiv</a></span>(<span class='no'>graph</span>), <span class='st'>"[["</span>, <span class='st'>"SE"</span>)
<span class='no'>SE</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>SE</span>, <span class='kw'>function</span>(<span class='no'>x</span>) {
   <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>/<span class='no'>x</span>
   <span class='no'>x</span>[!<span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span>(<span class='no'>x</span>)] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
   <span class='no'>x</span>
})


<span class='co'># These three lines are equivalent to:</span>
<span class='no'>expo_se2</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>, <span class='kw'>alt.graph</span><span class='kw'>=</span><span class='st'>"se"</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
<span class='co'># Notice that we are setting valued=TRUE, but this is not necesary since when</span>
<span class='co'># alt.graph = "se" the function checks this to be setted equal to TRUE</span>

<span class='co'># Weighted Exposure using degree --------------------------------------------</span>
<span class='no'>eDE</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>, <span class='kw'>attrs</span><span class='kw'>=</span><span class='fu'><a href='dgr.html'>dgr</a></span>(<span class='no'>graph</span>))

<span class='co'># Which is equivalent to</span>
<span class='no'>graph</span><span class='kw'>[[</span><span class='st'>"deg"</span>]] <span class='kw'>&lt;-</span> <span class='fu'><a href='dgr.html'>dgr</a></span>(<span class='no'>graph</span>)
<span class='no'>eDE2</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>, <span class='kw'>attrs</span><span class='kw'>=</span><span class='st'>"deg"</span>)

<span class='co'># Comparing using incoming edges -------------------------------------------</span>
<span class='no'>eIN</span> <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>graph</span>, <span class='kw'>outgoing</span><span class='kw'>=</span><span class='fl'>FALSE</span>)

<span class='co'># Structral equivalence for different communities ---------------------------</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>medInnovationsDiffNet</span>)

<span class='co'># METHOD 1: Using the c.diffnet method:</span>

<span class='co'># Creating subsets by city</span>
<span class='no'>cities</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='no'>medInnovationsDiffNet</span><span class='kw'>[[</span><span class='st'>"city"</span>]])

<span class='no'>diffnet</span> <span class='kw'>&lt;-</span> <span class='no'>medInnovationsDiffNet</span>[<span class='no'>medInnovationsDiffNet</span><span class='kw'>[[</span><span class='st'>"city"</span>]] <span class='kw'>==</span> <span class='no'>cities</span>[<span class='fl'>1</span>]]
<span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se"</span>]] <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>diffnet</span>, <span class='kw'>alt.graph</span><span class='kw'>=</span><span class='st'>"se"</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='kw'>for</span> (<span class='no'>v</span> <span class='kw'>in</span> <span class='no'>cities</span>[-<span class='fl'>1</span>]) {
   <span class='no'>diffnet_v</span> <span class='kw'>&lt;-</span> <span class='no'>medInnovationsDiffNet</span>[<span class='no'>medInnovationsDiffNet</span><span class='kw'>[[</span><span class='st'>"city"</span>]] <span class='kw'>==</span> <span class='no'>v</span>]
   <span class='no'>diffnet_v</span><span class='kw'>[[</span><span class='st'>"expo_se"</span>]] <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>diffnet_v</span>, <span class='kw'>alt.graph</span><span class='kw'>=</span><span class='st'>"se"</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>)
   <span class='no'>diffnet</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>diffnet</span>, <span class='no'>diffnet_v</span>)
}

<span class='co'># We can set the original order (just in case) of the data</span>
<span class='no'>diffnet</span> <span class='kw'>&lt;-</span> <span class='no'>diffnet</span>[<span class='no'>medInnovationsDiffNet</span>$<span class='no'>meta</span>$<span class='no'>ids</span>]
<span class='no'>diffnet</span></div><div class='output co'>#&gt; Dynamic network of class -diffnet-
#&gt;  Name               : Medical Innovation
#&gt;  Behavior           : Adoption of Tetracycline
#&gt;  # of nodes         : 125 (1001, 1002, 1003, 1004, 1005, 1006, 1007, 1008, ...)
#&gt;  # of time periods  : 18 (1 - 18)
#&gt;  Type               : directed
#&gt;  Final prevalence   : 1.00
#&gt;  Static attributes  : city, detail, meet, coll, attend, proage, length, ... (58)
#&gt;  Dynamic attributes : expo_se (1)</div><div class='input'>
<span class='co'># Checking everything is equal</span>
<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>medInnovationsDiffNet</span>, <span class='kw'>no.print</span><span class='kw'>=</span><span class='fl'>TRUE</span>) <span class='kw'>==</span>
   <span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>diffnet</span>, <span class='kw'>no.print</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>test</span>[!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>test</span>)]))

<span class='co'># METHOD 2: Using the 'groupvar' argument</span>
<span class='co'># Further, we can compare this with using the groupvar</span>
<span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se2"</span>]] <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>diffnet</span>, <span class='kw'>alt.graph</span><span class='kw'>=</span><span class='st'>"se"</span>,
   <span class='kw'>groupvar</span><span class='kw'>=</span><span class='st'>"city"</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='co'># These should be equivalent</span>
<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]] <span class='kw'>==</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se2"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>test</span>[!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>test</span>)]))

<span class='co'># METHOD 3: Computing exposure, rbind and then adding it to the diffnet object</span>
<span class='no'>expo_se3</span> <span class='kw'>&lt;-</span> <span class='kw'>NULL</span>
<span class='kw'>for</span> (<span class='no'>v</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span>(<span class='no'>cities</span>))
   <span class='no'>expo_se3</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span>(
     <span class='no'>expo_se3</span>,
     <span class='fu'>exposure</span>(
       <span class='no'>diffnet</span>[<span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"city"</span>]] <span class='kw'>==</span> <span class='no'>v</span>],
       <span class='kw'>alt.graph</span> <span class='kw'>=</span> <span class='st'>"se"</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>
     ))

<span class='co'># Just to make sure, we sort the rows</span>
<span class='no'>expo_se3</span> <span class='kw'>&lt;-</span> <span class='no'>expo_se3</span>[<span class='no'>diffnet</span>$<span class='no'>meta</span>$<span class='no'>ids</span>,]

<span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se3"</span>]] <span class='kw'>&lt;-</span> <span class='no'>expo_se3</span>

<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]] <span class='kw'>==</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se3"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>test</span>[!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>test</span>)]))


<span class='co'># METHOD 4: Using the groupvar in struct_equiv</span>
<span class='no'>se</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='struct_equiv.html'>struct_equiv</a></span>(<span class='no'>diffnet</span>, <span class='kw'>groupvar</span><span class='kw'>=</span><span class='st'>"city"</span>)
<span class='no'>se</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>se</span>, <span class='st'>"[["</span>, <span class='st'>"SE"</span>)
<span class='no'>se</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span>(<span class='no'>se</span>, <span class='kw'>function</span>(<span class='no'>x</span>) {
   <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>/<span class='no'>x</span>
   <span class='no'>x</span>[!<span class='fu'><a href='https://rdrr.io/r/base/is.finite.html'>is.finite</a></span>(<span class='no'>x</span>)] <span class='kw'>&lt;-</span> <span class='fl'>0</span>
   <span class='no'>x</span>
})

<span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se4"</span>]] <span class='kw'>&lt;-</span> <span class='fu'>exposure</span>(<span class='no'>diffnet</span>, <span class='kw'>alt.graph</span><span class='kw'>=</span><span class='no'>se</span>, <span class='kw'>valued</span><span class='kw'>=</span><span class='fl'>TRUE</span>)

<span class='no'>test</span> <span class='kw'>&lt;-</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]] <span class='kw'>==</span> <span class='no'>diffnet</span><span class='kw'>[[</span><span class='st'>"expo_se4"</span>, <span class='kw'>as.df</span><span class='kw'>=</span><span class='fl'>TRUE</span>]]
<span class='fu'><a href='https://rdrr.io/r/base/stopifnot.html'>stopifnot</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/all.html'>all</a></span>(<span class='no'>test</span>[!<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>test</span>)]))</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      <li><a href="#value">Value</a></li>
      <li><a href="#details">Details</a></li>
      <li><a href="#references">References</a></li>
      <li><a href="#see-also">See also</a></li>
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    <p>George G. Vega Yon &amp; Thomas W. Valente</p>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by George Vega Yon, Thomas Valente.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


